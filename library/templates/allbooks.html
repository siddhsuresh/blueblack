<html>
	<head>
		<title> All Books</title>
		<meta charset="utf-8">
    	<meta name="viewport" content="width=device-width, initial-scale=1">
    	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    	<style>
    	a {
			color: black;
			text-decoration: none;
		}
		@keyframes blinker {
		    from {opacity: 1.0;}
		    to {opacity: 0.0;}
		  }
		  
		.blink {
		    text-decoration: blink;
		    animation-name: blinker;
		    animation-duration: 0.6s;
		    animation-iteration-count:infinite;
		    animation-timing-function:ease-in-out;
		    animation-direction: alternate;
		  }
    	</style>
	</head>
	<body>
	<nav class="navbar nav-pills navbar-expand-lg navbar-light bg-light">
	  <div class="container-fluid">
	    <a class="navbar-brand" href="#">
	    	{% if user.is_authenticated %} Library Student
	    	{% else %} Library
	    	{% endif %}
		</a>
	    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
	      <span class="navbar-toggler-icon"></span>
	    </button>
	    <div class="collapse navbar-collapse" id="navbarSupportedContent">
	      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
	        <li class="nav-item">
	          <a class="nav-link" aria-current="page" href="/">Dashboard</a>
	        </li>
	        <li class="nav-item dropdown active">
	          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
	            Books
	          </a>
	          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
	            <li><a class="dropdown-item" href="/allbooks">All Books</a></li>
	            <li><hr class="dropdown-divider"></li>
	            {% if user.is_authenticated %}
				<li><a class="dropdown-item" href="/search">Search Books</a></li>
	            {% endif %}
	          </ul>
	        </li>
	        {% if user.is_authenticated %}
	        <li class="nav-item dropdown">
	          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
	            {{ user.username }}
	          </a>
	          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
	            <li><a class="dropdown-item" href="/profile">Profile</a></li>
	            <li><a class="dropdown-item" href="/viewissued">All Issued Books</a></li>
	            <li><a class="dropdown-item" href="/history" target="_blank">History</a></li>
	          </ul>
	        </li>
	        {% endif %}
	      </ul>
	      {% if user.is_authenticated %}
	      <form action="{% url 'logout' %}" class="d-flex">
	        <button class="btn btn-outline-success" type="submit">Logout</button>
	      </form>
	      {% else %}
	      <form action="{% url 'login' %}" class="d-flex">
	        <button class="btn btn-outline-primary" type="submit">Login</button>
	      </form>
	      {% endif %}
	    </div>
	  </div>
	</nav>
	<div class="container-fluid">
		<div class="input-group rounded">
    		<input id="user-input" class="form-control" placeholder="Search Books By Name...">
  			<span class="input-group-text border-0" id="search-addon">
    			<i class="fas fa-search" id="search-icon"></i>
  			</span>
		</div>
	</div>
  	<div class="container-fluid" id="replaceable-content">
  		{% include 'books-results-partial.html' %}
	</div>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<script>
		const user_input = $('#user-input')
		const search_icon = $('#search-icon')
		const books_div = $('#replaceable-content')
		const endpoint = '/allbooks/'
		const delay_by_in_ms = 10
		let scheduled_function = false

		let ajax_call = function (endpoint, request_parameters) {
		    $.getJSON(endpoint, request_parameters)
		        .done(response => {
		            // fade out the books_div, then:
		            books_div.fadeTo('fast', 0).promise().then(() => {
		                // replace the HTML contents
		                books_div.html(response['html_from_view'])
		                // fade-in the div with new contents
		                books_div.fadeTo('fast', 1)
		                // stop animating search icon
		                search_icon.removeClass('blink')
		            })
		        })
		}


		user_input.on('keyup', function () {

		    const request_parameters = {
		        q: $(this).val() // value of user_input: the HTML element with ID user-input
		    }

		    // start animating the search icon with the CSS class
		    search_icon.addClass('blink')

		    // if scheduled_function is NOT false, cancel the execution of the function
		    if (scheduled_function) {
		        clearTimeout(scheduled_function)
		    }

		    // setTimeout returns the ID of the function to be executed
		    scheduled_function = setTimeout(ajax_call, delay_by_in_ms, endpoint, request_parameters)
		})
	</script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
	</body>
</html>